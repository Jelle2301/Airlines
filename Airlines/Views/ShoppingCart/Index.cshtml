@model Airlines.ViewModels.ShoppingCartVM


@{
    ViewData["Title"] = "Index";
}
<h3><em>Review</em> your cart:</h3>

@if (Model?.Carts?.Any() == true)



{
    <div class="row">
        <div class="col navbar-brand"></div>
        <div class="col-6 navbar-text text-end">
            <small class="navbar-text">
                <b>Your cart:</b> @*@Model.Carts.Sum(x => x.Count) item(s) -*@ @Model.ComputeTotalValue().ToString("c")
            </small>
        </div>
    </div>

    <form asp-action="Payment">
        <table class="table table-striped">
            <thead>
                <tr>

                    <th>Voornaam</th>
                    <th>Achternaam</th>
                    <th>Prijs</th>
                    <th>Maaltijd</th>
                    <th>Reisklasse</th>
                    <th>Seizoen</th>

                </tr>
            </thead>
            <tbody>
                @foreach (var (cartItem, index) in Model.Carts.Select((value, i) => (value, i)))

                {
                    <tr>

                        <td>
                            <input asp-for="@cartItem.Ticket.Voornaam" class="form-control" readonly />
                        </td>
                        <td>
                            <input asp-for="@cartItem.Ticket.Achternaam" class="form-control" readonly />
                        </td>
                        <!--die asp-for zal ook id maken-->
                        <td>
                            <input asp-for="@cartItem.Ticket.Prijs" type="number" class="form-control" readonly />
                        </td>
                        <td>
                            <input asp-for="@cartItem.Ticket.Maaltijd.Naam" class="form-control" readonly />
                        </td>
                        <td>
                            <input asp-for="@cartItem.Ticket.Reisklasse.SoortReisklasse" class="form-control" readonly />
                        </td>
                        @if (cartItem.Ticket.Seizoen != null)
                        {
                            <td>
                                <input asp-for="@cartItem.Ticket.Seizoen.SoortPeriode" class="form-control" readonly />
                            </td>
                        }else{
                            <td>
                                <p>Geen seizoen actief</p>
                            </td>
                        }
                        @*
                        <td>
                            <a asp-action="Delete" asp-route-bierNr="@cartItem.BeerNumber">
                                <img src="~/images/delete.png" alt="Delete" />
                            </a>
                        </td>
                        *@
                    </tr>
                }
            </tbody>
        </table>

        <div class="row">
            <div class="col-md-6">
                <input type="submit" value="Checkout" class="btn btn-primary" />
            </div>
            <div class="col-md-6 text-end">
                <strong>Total: </strong>
                <input id="txtTotal" value="@Model.Carts.Sum(x => x.Ticket.Prijs)" class="form-control d-inline w-auto" readonly />
            </div>
        </div>
    </form>
}

else

{
    <p>Your shopping cart is empty at the moment.</p>
}
@section Scripts {
    <!--
    <script>
        $(document).ready(() => {
            //zoek alles van id die eindigd op count
            $("[id$=Count]").on("change", (e) => {
                //e is object dat event heeft veroorzaakt
               let row = $(e.currentTarget).closest("tr");
               let quantity = $(e.currentTarget.val());

               let price = row.find("input[id$='_Price']").val();

               let subtotal = quantity*price);
               let number = $(e.currentTarget).data("aantal");
               $("#subtotal-" + number).val(subtotal);
               let total = 0;
               /*
               for(var item in Model.Carts){
                   total+= item.currentTarget.subtotal;
               }
               */
            });
        });

    </script>
    -->
    <script>
        $(document).ready(() => {
            $("[id$=Count]").on("change", (e) => {

                let row = $(e.currentTarget).closest("tr");

                let quantity = $(e.currentTarget).val();

                let price = row.find("input[id$='Prijs']").val(); // Zoek de prijs binnen de rij

                let subtotal = quantity * price;
                let number = $(e.currentTarget).data("aantal");

                $("#subtotal-" + number).val(subtotal);


                let total = 0;
                $("input[id^=subtotal-]").each( (index, item) => {// die ^= pakt alles erachter en $= alles ervoor
                    //die input zegt datje alle invoervelden wilt krijgen/nemen
                    //index is voor te zeggen welk item, is verplicht
                    let val = parseFloat($(item).val());
                    total += val;

                });

                $("#txtTotal").val(total);
            });
        });
    </script>

}